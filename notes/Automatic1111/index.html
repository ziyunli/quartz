<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Lab Notes 2023-06-14 Getting Started I have been sleeping on Stable Diffusion for a while, but the recent ControlNet for QR Code sparked my interest again."><meta property="og:title" content="Automatic1111"><meta property="og:description" content="Lab Notes 2023-06-14 Getting Started I have been sleeping on Stable Diffusion for a while, but the recent ControlNet for QR Code sparked my interest again."><meta property="og:type" content="website"><meta property="og:image" content="https://ziyunli.github.io/quartz/icon.png"><meta property="og:url" content="https://ziyunli.github.io/quartz/notes/Automatic1111/"><meta property="og:width" content="200"><meta property="og:height" content="200"><meta name=twitter:card content="summary"><meta name=twitter:title content="Automatic1111"><meta name=twitter:description content="Lab Notes 2023-06-14 Getting Started I have been sleeping on Stable Diffusion for a while, but the recent ControlNet for QR Code sparked my interest again."><meta name=twitter:image content="https://ziyunli.github.io/quartz/icon.png"><title>Automatic1111</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://ziyunli.github.io/quartz//icon.png><link href=https://ziyunli.github.io/quartz/styles.80333fa2099c0bee674efa435fde378c.min.css rel=stylesheet><link href=https://ziyunli.github.io/quartz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://ziyunli.github.io/quartz/js/darkmode.390405ce4fa88508cf8c697cadc4cf14.min.js></script>
<script src=https://ziyunli.github.io/quartz/js/util.00639692264b21bc3ee219733d38a8be.min.js></script>
<link rel=preload href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css as=style onload='this.onload=null,this.rel="stylesheet"' integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/core@1.2.1></script>
<script src=https://cdn.jsdelivr.net/npm/@floating-ui/dom@1.2.1></script>
<script defer src=https://ziyunli.github.io/quartz/js/popover.aa9bc99c7c38d3ae9538f218f1416adb.min.js></script>
<script defer src=https://ziyunli.github.io/quartz/js/code-title.ce4a43f09239a9efb48fee342e8ef2df.min.js></script>
<script defer src=https://ziyunli.github.io/quartz/js/clipboard.2913da76d3cb21c5deaa4bae7da38c9f.min.js></script>
<script defer src=https://ziyunli.github.io/quartz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://ziyunli.github.io/quartz/",fetchData=Promise.all([fetch("https://ziyunli.github.io/quartz/indices/linkIndex.c4f20ff6f5c99c3ef51c3f588ae6bd47.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://ziyunli.github.io/quartz/indices/contentIndex.83d91b7330fc8a35a618a5d3c35498a6.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://ziyunli.github.io/quartz",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://ziyunli.github.io/quartz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()});function a(n){const e=n.target,t=e.className.split(" "),s=t.includes("broken"),o=t.includes("internal-link");plausible("Link Click",{props:{href:e.href,broken:s,internal:o,graph:!1}})}const r=document.querySelectorAll("a");for(link of r)link.className.includes("root-title")&&link.addEventListener("click",a,{once:!0})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/ziyunli.github.io\/quartz\/js\/router.d6fe6bd821db9ea97f9aeefae814d8e7.min.js"
    attachSPARouting(init, render)
  </script><script defer data-domain=ziyunli.github.io/quartz src=https://plausible.io/js/script.js></script>
<script>window.plausible=window.plausible||function(){(window.plausible.q=window.plausible.q||[]).push(arguments)}</script></head><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://ziyunli.github.io/quartz/js/full-text-search.e6e2e0c213187ca0c703d6e2c7a77fcd.min.js></script><div class=singlePage><header><h1 id=page-title><a class=root-title href=https://ziyunli.github.io/quartz/>ðŸª´ Ziyun's Backyard</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Automatic1111</h1><p class=meta>Last updated
Jul 3, 2023
<a href=https://github.com/ziyunli/quartz/tree/hugo/content/notes/Automatic1111.md rel=noopener>Edit Source</a></p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#lab-notes>Lab Notes</a><ol><li><a href=#2023-06-14-getting-started>2023-06-14 Getting Started</a></li></ol></li></ol></nav></details></aside><a href=#lab-notes><h2 id=lab-notes><span class=hanchor arialabel=Anchor># </span>Lab Notes</h2></a><a href=#2023-06-14-getting-started><h3 id=2023-06-14-getting-started><span class=hanchor arialabel=Anchor># </span>2023-06-14 Getting Started</h3></a><p>I have been sleeping on Stable Diffusion for a while, but the recent
<a href=https://www.reddit.com/r/StableDiffusion/comments/141hg9x/controlnet_for_qr_code/ rel=noopener>ControlNet for QR Code</a> sparked my interest again. So, as always, I am late to the party. But I guess it is better late than never.
There is already a comprehensive
<a href=https://stable-diffusion-art.com/qr-code/ rel=noopener>step-by-step tutorial</a> on the QR code generation, so I decided to follow it on my first attempt.</p><p>The first step is to get
<a href=https://github.com/AUTOMATIC1111/stable-diffusion-webui rel=noopener>stable-diffusion-webui</a> running.
One tiny thing that I didn&rsquo;t know before I started is that people in the community just call it Automatic1111, or even A1111.
Knowing this helps a bit when you are googling.
The same website has a
<a href=https://stable-diffusion-art.com/install-mac/ rel=noopener>tutorial</a> for Mac installation, but it makes things sound much harder than it actually is.
You mostly just clone the repo, download models and/or checkpoints to <code>models/</code> and run <code>./webui.sh</code> and you are good to go.
The first time took a while because it needs to download the dependencies and models.
I also noticed <code>Warning: caught exception 'Torch not compiled with CUDA enabled', memory monitor disabled</code> in the log, which seems like it&rsquo;s only using the CPU.</p><p>The next step is to install the
<a href=https://github.com/Mikubill/sd-webui-controlnet rel=noopener>ControlNet extension</a>, which also has its own
<a href=https://stable-diffusion-art.com/controlnet/ rel=noopener>tutorial</a>.
The installation itself is so straightforward, as described in the
<a href=https://github.com/Mikubill/sd-webui-controlnet#installation rel=noopener>Readme</a>, that I didn&rsquo;t bother to read the tutorial.
This turns out to be a noob mistake. The tutorial talks about the concept and the different models, which would have saved me a lot of time later.</p><p>Finally, we have everything ready for the QR code generation. The requirements for the QR code are quite interesting:</p><blockquote><ul><li>Use a high fault tolerance setting (30%).</li><li>Have a white margin around the QR Code (the quiet zone).</li><li>Use the most basic square fill with a black-and-white pattern.</li><li>Avoid using generators that introduce a thin white line between black elements.</li></ul></blockquote><p>From
<a href=https://arstechnica.com/information-technology/2023/06/redditor-creates-working-anime-qr-codes-using-stable-diffusion/ rel=noopener>another article</a>, it seems to leverage the innate error correction feature so that the QR code can be distorted to fit the generated image while still being readable.
However, even with a high fault tolerance setting, the generated QR code is still a hit or miss.</p><p>And here comes my second noob mistake&mldr; I totally didn&rsquo;t keep track of the parameters for each generation! Fortunately, A1111 has me covered: there is a &ldquo;PNG Info&rdquo; tab that can read the parameters from the generated image. Interestingly, I can&rsquo;t figure out how to read this information in the macOS native preview app, so I wonder if the data is stored in the PNG file in a slightly special way.</p><p>Now, for example, compare these two images that are generated with the same prompt and seed.
The first one is (borderline) readable.</p><blockquote><p>((masterpiece),(best quality),(ultra-detailed), (upper body:1.2), 1male, solo, hood up, cyborg mask, glowing eyes, facing camera, neon details, male focus, cloak, spaceship, lightning, ultra realistic details, portrait, global illumination, shadows, octane render, 8k, ultra sharp,intricate, ornaments detailed, cold colors, metal, egypician detail, highly intricate details, realistic light, trending on cgsociety, time travel, break mirror</p><p>Negative prompt: ugly, disfigured, low quality, blurry, nsfw</p><p>Steps: 50, Sampler: DPM++ 2M Karras, CFG scale: 7, Seed: 3502696068, Size: 768x768, Model hash: e3edb8a26f, Model: ghostmix_v20Bakedvae, Denoising strength: 0.75, ControlNet: &ldquo;preprocessor: tile_resample, model: control_v11f1e_sd15_tile [a371b31b], weight: 1, starting/ending: (0.23, 0.7), resize mode: Crop and Resize, pixel perfect: False, control mode: Balanced, preprocessor params: (-1, 1, -1)&rdquo;, Version: v1.3.2</p></blockquote><p><img src=https://ziyunli.github.io/quartz//assets/qr-hit.png width=auto alt=Readable></p><p>But the second one is not.</p><blockquote><p>((masterpiece),(best quality),(ultra-detailed), (upper body:1.2), 1male, solo, hood up, cyborg mask, glowing eyes, facing camera, neon details, male focus, cloak, spaceship, lightning, ultra realistic details, portrait, global illumination, shadows, octane render, 8k, ultra sharp,intricate, ornaments detailed, cold colors, metal, egypician detail, highly intricate details, realistic light, trending on cgsociety, time travel, break mirror</p><p>Negative prompt: ugly, disfigured, low quality, blurry, nsfw</p><p>Steps: 50, Sampler: DPM++ 2M Karras, CFG scale: 7, Seed: 3502696068, Size: 768x768, Model hash: e3edb8a26f, Model: ghostmix_v20Bakedvae, Denoising strength: 0.75, ControlNet: &ldquo;preprocessor: tile_resample, model: control_v11f1e_sd15_tile [a371b31b], weight: 1, starting/ending: (0.24, 0.8), resize mode: Crop and Resize, pixel perfect: False, control mode: Balanced, preprocessor params: (-1, 1, -1)&rdquo;, Version: v1.3.2</p></blockquote><p><img src=https://ziyunli.github.io/quartz//assets/qr-miss.png width=auto alt=Unreadable></p><p>The only difference here is the &ldquo;Ending Control Step&rdquo;, from 0.7 to 0.8.
As in the document said: &ldquo;Decrease to stop the ControlNet earlier so that the QR code and the image can blend more naturally.&rdquo;
You can see that in the second QR code, the character is less distorted, but the QR code is not readable anymore.</p><p>I think the same seed also generates relatively similar images. For example, the below is generated with the same seed but different prompt and input.
You can definitely relate to the previous two images in terms of the overall style.</p><blockquote><p>light, futobot, cyborg, ((masterpiece),(best quality),(ultra-detailed), (upper body:1.2), 1male, solo, hood up, upper body, mask, facing camera, male focus, cloak, spaceship, lightning, ultra realistic details, portrait, global illumination, shadows, octane render, 8k, ultra sharp,intricate, ornaments detailed, cold colors, metal, egypician detail, highly intricate details, realistic light, trending on cgsociety, neon details, time travel, broken mirror</p><p>Negative prompt: ugly, disfigured, low quality, blurry</p><p>Steps: 50, Sampler: DPM++ 2M Karras, CFG scale: 7, Seed: 3502696068, Size: 768x768, Model hash: e3edb8a26f, Model: ghostmix_v20Bakedvae, Denoising strength: 0.75, ControlNet: &ldquo;preprocessor: depth_leres++, model: control_v11f1p_sd15_depth [cfd03158], weight: 1, starting/ending: (0, 1), resize mode: Crop and Resize, pixel perfect: False, control mode: ControlNet is more important, preprocessor params: (512, 0, 0)&rdquo;, Version: v1.3.2</p></blockquote><p><img src=https://ziyunli.github.io/quartz//assets/seed-3502696068.png width=auto alt="Same seed"></p><p>Therefore, my workflow right now is</p><ol><li>Cherry pick some keywords from some example prompts</li><li>Keep hitting generate to roll the dice with -1 seed</li><li>Once I see one somewhat close to the vibe I am looking for, I will fix the seed and tweak the prompt and parameters.</li></ol><p>Given that basically I am throwing things at the wall and see what sticks, the generation speed is critical.
Unfortunately, with M1, it&rsquo;s quite slow: it takes me ~3 minutes to generate one image.
I generated ~40 images in total last night. It was a pretty boring two-hour period that I actually had to start this post&mldr;</p><p>I do have a PC with a dedicated GPU sitting around, even though it&rsquo;s a mere 1660.
That&rsquo;s going to be my next thing to test before I opt for more powerful options (in which case, Google Colab and Paperspace would be my first choices).</p><p>By the way, I got quite lucky with my fifth image, and I am quite happy with how it looks.
This will be my QR code for me advertising this blog for a while.</p><p><img src=https://ziyunli.github.io/quartz//assets/me.png width=auto alt="Me time traveling from 2077"></p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/quartz/notes/Stable-Diffusion/ data-ctx=Automatic1111 data-src=/notes/Stable-Diffusion class=internal-link>Stable Diffusion</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://ziyunli.github.io/quartz/js/graph.6579af7b10c818dbd2ca038702db0224.js></script></div></div><div id=contact_buttons><footer><p>Made by Ziyun Li using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2023</p><ul><li><a href=https://ziyunli.github.io/quartz/>Home</a></li><li><a href=https://fedi.ziyun.rocks/@ziyun>Mastodon</a></li><li><a href=https://github.com/ziyunli>GitHub</a></li></ul></footer></div></div></body></html>